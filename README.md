# 蓝心大模型聊天和多模态助手

这是一个基于蓝心大模型API的多功能控制台应用程序，提供聊天、AI绘画、图片分析和语音识别功能。

## 功能介绍

- **聊天功能**：与蓝心大模型进行多轮对话，支持流式响应
- **绘画功能**：使用蓝心AI绘画API生成图片，支持多种风格和参数设置
- **图片分析功能**：使用蓝心多模态模型分析和理解图片内容
- **语音识别功能**：实时录音并转换为文本，支持WAV文件识别
- **终端界面**：美观的彩色终端界面，支持命令行参数配置

## 安装与配置

### 依赖

- Python 3.6+
- requests
- websocket-client
- pyaudio
- wave
- argparse

### 安装

1. 克隆仓库或下载源代码
2. 安装依赖：
   ```bash
   pip install requests websocket-client pyaudio wave
   ```

## 使用方法

### 聊天功能

运行主程序进入聊天模式：

```bash
python chat_app.py
```

支持的命令行参数：

```
--app_id APP_ID        指定应用ID
--app_key APP_KEY      指定应用密钥
--temperature TEMP     设置温度参数(0.1-1.0)
--max_tokens TOKENS    设置最大生成长度
--no_stream            禁用流式输出
--debug                启用调试模式
--draw                 直接进入绘画模式
--vision               直接进入图片分析模式
--speech               直接进入语音识别模式
```

### 绘画功能

#### 从聊天模式进入绘画模式

在聊天模式中输入以下命令进入专用的绘画模式：

```
/draw
```

或者直接使用聊天模式中的绘画命令：

```
/draw 一只可爱的猫咪
```

#### 直接启动绘画模式

使用`--draw`参数直接进入绘画模式：

```bash
python chat_app.py --draw
```

#### 绘画模式命令

绘画模式下支持的命令：

| 命令 | 描述 |
|------|------|
| `/draw <提示词>` | 创建新的绘图任务 |
| `/styles` | 显示可用的绘画风格列表 |
| `/prompts` | 显示推荐的绘画提示词 |
| `/status <任务ID>` | 查询特定任务的状态 |
| `/cancel <任务ID>` | 取消绘画任务 |
| `/settings` | 查看或修改绘画设置 |
| `/back` | 返回聊天模式 |
| `/help` | 显示帮助信息 |

#### 绘画参数

创建绘图时可以使用以下参数：

```
/draw 可爱的猫咪 --style <风格ID> --width 1024 --height 768 --cfg 7 --steps 20 --seed 12345 --negative "模糊,低质量"
```

参数解释：

- `--style`：风格模板ID，使用`/styles`命令可查看所有可用风格
- `--width`：图像宽度，单位像素
- `--height`：图像高度，单位像素
- `--cfg`：文本相关度，范围3-15
- `--steps`：采样步数，范围20-50
- `--seed`：随机种子，用于生成可复现的结果
- `--negative`：反向提示词，指定不希望在图像中出现的元素

### 图片分析功能

#### 从聊天模式进入图片分析模式

在聊天模式中输入以下命令进入专用的图片分析模式：

```
/vision
```

或者直接使用聊天模式中的图片分析命令：

```
/analyze test.jpg 描述图片的内容
```

#### 直接启动图片分析模式

使用`--vision`参数直接进入图片分析模式：

```bash
python chat_app.py --vision
```

#### 图片分析模式命令

图片分析模式下支持的命令：

| 命令 | 描述 |
|------|------|
| `/analyze <图片路径> [提示词]` | 分析指定图片 |
| `/browse [目录路径]` | 浏览目录中的图片 |
| `/models` | 显示可用的分析模型 |
| `/set model <模型名称>` | 设置要使用的模型 |
| `/examples` | 显示分析提示词示例 |
| `/back` | 返回聊天模式 |
| `/help` | 显示帮助信息 |

#### 图片分析示例

1. 分析图片的基本内容：
   ```
   /analyze photo.jpg 描述图片的内容
   ```

2. 识别图片中的文字：
   ```
   /analyze document.jpg 图片中的文字是什么？
   ```

3. 分析图片中的场景：
   ```
   /analyze landscape.jpg 这张照片是在什么地方拍摄的？
   ```

#### 支持的分析模型

蓝心多模态模型支持以下模型：

- **BlueLM-Vision-prd**：图片理解、文本创作、文本提取，上下文4096tokens
- **vivo-BlueLM-V-2.0**：文本提取，输入+输出2048tokens

### 语音识别功能

#### 从聊天模式进入语音识别模式

在聊天模式中输入以下命令进入专用的语音识别模式：

```
/speech
```

或者直接使用聊天模式中的语音识别命令：

```
/record 5
```

#### 直接启动语音识别模式

使用`--speech`参数直接进入语音识别模式：

```bash
python chat_app.py --speech
```

#### 语音识别模式命令

语音识别模式下支持的命令：

| 命令 | 描述 |
|------|------|
| `/record [持续时间]` | 录音并识别 |
| `/recognize <文件路径>` | 识别音频文件 |
| `/save <文件名> [持续时间]` | 录音并保存 |
| `/files` | 列出音频文件目录 |
| `/back` | 返回聊天模式 |
| `/help` | 显示帮助信息 |

#### 语音识别示例

1. 录制5秒钟音频并识别：
   ```
   /record 5
   ```

2. 保存10秒钟的录音：
   ```
   /save test.wav 10
   ```

3. 识别已有的音频文件：
   ```
   /recognize audio/test.wav
   ```

## 注意事项

- 语音识别仅支持16k/16bit单声道PCM格式的WAV文件
- 单次录音时长不超过60秒
- 录音文件将保存在`./audio`目录中
- **由于API凭据问题，目前语音识别功能无法正常使用，预期会返回认证失败。**

## 技术详情

该应用程序使用以下API：

- 蓝心大模型聊天API
- 蓝心AI绘画API
- 蓝心多模态模型API（图片分析）
- 蓝心语音识别API（基于WebSocket）

## 功能测试结果

| 功能模块 | 测试项 | 预期结果 | 实际结果 | 状态 | 备注 |
|---|---|---|---|---|---|
| **通用** | 启动应用 | 成功进入聊天模式 |  |  |  |
|  | `/help` (聊天模式) | 显示聊天帮助信息 |  |  |  |
|  | `exit` / `quit` | 退出应用 |  |  |  |
| **聊天功能** | 单轮对话 (流式) | AI回复 |  |  |  |
|  | 多轮对话 (流式) | AI基于历史回复 |  |  |  |
|  | 单轮对话 (非流式) | AI一次性回复 |  |  |  |
|  | Debug模式 | 打印调试信息 |  |  |  |
| **绘画功能** | `--draw` 启动 | 进入绘画模式 |  |  |  |
|  | `/draw` (聊天模式) | 进入绘画模式 |  |  |  |
|  | `/help` (绘画模式) | 显示绘画帮助信息 |  |  |  |
|  | 提示词绘图 (绘画模式) | 提交任务并返回任务ID |  |  |  |
|  | `/styles` (绘画模式) | 显示风格列表 |  |  |  |
|  | `/prompts` (绘画模式) | 显示推荐提示词 |  |  |  |
|  | `/settings` (绘画模式) | 显示并可修改设置 |  |  |  |
|  | `/draw <提示词>` (聊天模式) | 提交任务并返回任务ID |  |  |  |
|  | `/status <任务ID>` (绘画模式) | 查询任务状态 |  |  |  |
|  | `/cancel <任务ID>` (绘画模式) | 取消任务 |  |  |  |
|  | `/back` (绘画模式) | 返回聊天模式 |  |  |  |
| **图片分析功能** | `--vision` 启动 | 进入图片分析模式 |  |  |  |
|  | `/vision` (聊天模式) | 进入图片分析模式 |  |  |  |
|  | `/help` (图片分析模式) | 显示图片分析帮助信息 |  |  |  |
|  | `/analyze <路径> [提示]` (图片分析模式) | 分析图片并返回结果 |  |  |  |
|  | `/browse` (图片分析模式) | 列出图片文件 |  |  |  |
|  | `/models` (图片分析模式) | 显示可用模型 |  |  |  |
|  | `/set model <模型>` (图片分析模式) | 切换模型 |  |  |  |
|  | `/analyze <路径> [提示]` (聊天模式) | 分析图片并返回结果 |  |  |  |
|  | `/back` (图片分析模式) | 返回聊天模式 |  |  |  |
| **语音识别功能** | `--speech` 启动 | 进入语音识别模式 (预期认证失败) |  |  |  |
|  | `/speech` (聊天模式) | 进入语音识别模式 (预期认证失败) |  |  |  |
|  | `/help` (语音识别模式) | 显示语音识别帮助信息 |  |  |  |
|  | `/record [时长]` (语音识别模式) | 录音并识别 (预期认证失败) |  |  |  |
|  | `/recognize <路径>` (语音识别模式) | 识别文件 (预期认证失败) |  |  |  |
|  | `/save <文件名> [时长]` (语音识别模式) | 保存录音 (预期认证失败) |  |  |  |
|  | `/files` (语音识别模式) | 列出音频文件 |  |  |  |
|  | `/record [时长]` (聊天模式) | 录音并识别 (预期认证失败) |  |  |  |
|  | `/back` (语音识别模式) | 返回聊天模式 |  |  |  |

## 作者

[作者名] - [联系方式]

## 许可

[许可证信息] 